<!-- Stake management form -->
<form class="stake-form p-4 space-y-4"
      hx-put="/api/miner/modules/{{ module }}/stake"
      hx-target="#main-content">
    
    <!-- Error messages -->
    {% if !errors.is_empty() %}
    <div class="errors bg-red-50 border-red-200 text-red-700 p-4 rounded-lg">
        {% for error in errors %}
        <p>{{ error }}</p>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Current stake -->
    <div class="current-stake p-4 border rounded-lg bg-gray-50">
        <h4 class="text-sm font-medium text-gray-700">Current Stake</h4>
        <p class="text-2xl font-bold mt-1">{{ current_stake }}</p>
        <p class="text-sm text-gray-500">
            Available balance: {{ available_balance }}
        </p>
    </div>

    <!-- Stake amount -->
    <div class="form-group">
        <label for="stake_amount" class="block text-sm font-medium text-gray-700">
            New Stake Amount
        </label>
        <div class="mt-1 relative rounded-md shadow-sm">
            <input type="number"
                   id="stake_amount"
                   name="stake_amount"
                   value="{{ current_stake }}"
                   min="0"
                   max="{{ current_stake + available_balance }}"
                   class="block w-full rounded-md border-gray-300"
                   required>
        </div>
        <div class="mt-1 flex justify-between text-sm text-gray-500">
            <span>Min: 0</span>
            <span>Max: {{ current_stake + available_balance }}</span>
        </div>
    </div>

    <!-- Auto-compound -->
    <div class="form-group">
        <label class="flex items-center">
            <input type="checkbox"
                   name="auto_compound"
                   class="rounded border-gray-300 text-blue-600 shadow-sm">
            <span class="ml-2 text-sm text-gray-700">
                Auto-compound rewards
            </span>
        </label>
        <p class="mt-1 text-sm text-gray-500 ml-6">
            Automatically reinvest earned rewards
        </p>
    </div>

    <!-- Preview changes -->
    <div class="preview p-4 border rounded-lg bg-gray-50 hidden"
         id="stakePreview">
        <h4 class="text-sm font-medium text-gray-700 mb-2">Preview Changes</h4>
        <div class="grid grid-cols-2 gap-4 text-sm">
            <div>
                <p class="text-gray-500">Current stake</p>
                <p class="font-medium">{{ current_stake }}</p>
            </div>
            <div>
                <p class="text-gray-500">New stake</p>
                <p class="font-medium" id="previewNewStake">-</p>
            </div>
            <div>
                <p class="text-gray-500">Change</p>
                <p class="font-medium" id="previewChange">-</p>
            </div>
            <div>
                <p class="text-gray-500">Remaining balance</p>
                <p class="font-medium" id="previewBalance">-</p>
            </div>
        </div>
    </div>

    <!-- Submit buttons -->
    <div class="flex justify-between">
        <button type="button"
                class="btn btn-secondary"
                hx-get="/components/miner/dashboard"
                hx-target="#main-content">
            Cancel
        </button>
        <button type="submit" 
                class="btn btn-primary"
                hx-disable>
            Update Stake
        </button>
    </div>
</form>

<!-- Preview calculation script -->
<script>
document.getElementById('stake_amount').addEventListener('input', function(e) {
    const preview = document.getElementById('stakePreview');
    const newStake = parseInt(e.target.value) || 0;
    const currentStake = {{ current_stake }};
    const change = newStake - currentStake;
    const remainingBalance = {{ available_balance }} - change;

    document.getElementById('previewNewStake').textContent = newStake;
    document.getElementById('previewChange').textContent = change >= 0 ? `+${change}` : change;
    document.getElementById('previewBalance').textContent = remainingBalance;
    
    preview.classList.remove('hidden');
});
</script>
